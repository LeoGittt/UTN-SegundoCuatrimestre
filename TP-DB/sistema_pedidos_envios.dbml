// =========================================================================
// SISTEMA DE GESTI√ìN DE PEDIDOS Y ENV√çOS - TFI BASE DE DATOS I
// Archivo: sistema_pedidos_envios.dbml
// Prop√≥sito: Diagrama Entidad-Relaci√≥n para dbdiagram.io
// Relaci√≥n: 1:1 entre Pedidos y Env√≠os
// Autor: TFI Bases de Datos I - UTN
// =========================================================================

Project TFI_Sistema_Pedidos_Envios {
  database_type: 'PostgreSQL'
  Note: '''
    Sistema de Gesti√≥n de Pedidos y Env√≠os
    Trabajo Final Integrador - Bases de Datos I
    Universidad Tecnol√≥gica Nacional (UTN)
    
    Caracter√≠sticas principales:
    - Relaci√≥n 1:1 entre Pedidos y Env√≠os
    - Baja l√≥gica implementada
    - Restricciones de integridad completas
    - Validaciones de dominio con CHECK constraints
  '''
}

// =========================================================================
// TABLA: PEDIDOS
// =========================================================================
Table Pedidos {
  id bigserial [primary key, note: 'Clave primaria autoincremental']
  eliminado boolean [not null, default: false, note: 'Baja l√≥gica: FALSE=activo, TRUE=eliminado']
  
  // Datos del pedido
  numero varchar(20) [not null, unique, note: 'C√≥digo √∫nico del pedido (formato: PED-XXXXX)']
  fecha date [not null, note: 'Fecha de creaci√≥n del pedido']
  clienteNombre varchar(120) [not null, note: 'Nombre del cliente que realiza el pedido']
  total decimal(12,2) [not null, note: 'Monto total del pedido (validado >= 0)']
  estado varchar(20) [not null, note: 'Estado del pedido: NUEVO, FACTURADO, ENVIADO']
  
  // √çndices
  indexes {
    (numero) [unique, name: 'idx_pedidos_numero']
    (clienteNombre, fecha) [name: 'idx_pedidos_cliente_fecha']
    (estado, eliminado) [name: 'idx_pedidos_estado_eliminado']
  }
  
  Note: '''
    Tabla principal que almacena informaci√≥n de pedidos realizados por clientes.
    
    Restricciones implementadas:
    - CHECK: total >= 0.00
    - CHECK: estado IN ('NUEVO', 'FACTURADO', 'ENVIADO')
    
    Baja l√≥gica: Los registros no se eliminan f√≠sicamente, 
    se marca el campo 'eliminado' como TRUE.
  '''
}

// =========================================================================
// TABLA: ENV√çOS
// =========================================================================
Table Envios {
  id bigserial [primary key, note: 'Clave primaria autoincremental']
  eliminado boolean [not null, default: false, note: 'Baja l√≥gica: FALSE=activo, TRUE=eliminado']
  
  // Datos del env√≠o
  tracking varchar(40) [unique, note: 'C√≥digo de seguimiento √∫nico del env√≠o']
  costo decimal(10,2) [not null, note: 'Costo del env√≠o (validado >= 0)']
  empresa varchar(30) [not null, note: 'Empresa transportista: ANDREANI, OCA, CORREO_ARG']
  tipo varchar(20) [not null, note: 'Tipo de env√≠o: ESTANDAR, EXPRES']
  estado varchar(30) [not null, note: 'Estado del env√≠o: EN_PREPARACION, EN_TRANSITO, ENTREGADO']
  fechaDespacho date [note: 'Fecha de despacho del env√≠o']
  fechaEstimada date [note: 'Fecha estimada de entrega']
  
  // Relaci√≥n 1:1 con Pedidos
  pedido_id bigint [not null, unique, ref: - Pedidos.id, note: 'FK √∫nica hacia Pedidos (garantiza relaci√≥n 1:1)']
  
  // √çndices
  indexes {
    (tracking) [unique, name: 'idx_envios_tracking']
    (pedido_id) [unique, name: 'idx_envios_pedido_unique']
    (empresa, estado) [name: 'idx_envios_empresa_estado']
    (fechaDespacho, fechaEstimada) [name: 'idx_envios_fechas']
  }
  
  Note: '''
    Tabla que gestiona env√≠os asociados a pedidos con relaci√≥n 1:1.
    
    Restricciones implementadas:
    - CHECK: costo >= 0.00
    - CHECK: empresa IN ('ANDREANI', 'OCA', 'CORREO_ARG')
    - CHECK: tipo IN ('ESTANDAR', 'EXPRES')
    - CHECK: estado IN ('EN_PREPARACION', 'EN_TRANSITO', 'ENTREGADO')
    - CHECK: fechaEstimada >= fechaDespacho
    
    Relaci√≥n 1:1: pedido_id es UNIQUE y NOT NULL, 
    garantizando que cada pedido tenga exactamente un env√≠o.
    
    Eliminaci√≥n en cascada: ON DELETE CASCADE desde Pedidos.
  '''
}

// =========================================================================
// RELACIONES
// =========================================================================
Ref: Pedidos.id - Envios.pedido_id [
  note: '''
    Relaci√≥n 1:1 entre Pedidos y Env√≠os
    
    Caracter√≠sticas:
    - Un pedido tiene exactamente un env√≠o
    - Un env√≠o pertenece a exactamente un pedido
    - Implementada con FK + UNIQUE constraint
    - Eliminaci√≥n en cascada (CASCADE)
    
    Reglas de negocio:
    - Todo pedido debe tener un env√≠o asociado
    - No puede existir un env√≠o sin pedido
    - La relaci√≥n es obligatoria y un√≠voca
  '''
]

// =========================================================================
// NOTAS ADICIONALES DEL PROYECTO
// =========================================================================
Note project_info {
  '''
  INFORMACI√ìN DEL PROYECTO TFI
  
  üìã Cumplimiento de Requisitos Acad√©micos:
  ‚úÖ DER con 2+ entidades (Pedidos, Env√≠os)
  ‚úÖ Relaci√≥n 1:1 correctamente modelada
  ‚úÖ PRIMARY KEY en ambas tablas (BIGSERIAL)
  ‚úÖ FOREIGN KEY con integridad referencial
  ‚úÖ UNIQUE constraints para garantizar unicidad
  ‚úÖ CHECK constraints para validaciones de dominio
  ‚úÖ Restricciones de dominio completas
  
  üîß Caracter√≠sticas T√©cnicas:
  - Motor: PostgreSQL 13+
  - Escalabilidad: 20,000+ registros
  - Baja l√≥gica: Eliminaci√≥n no destructiva
  - Integridad: Validaciones a nivel BD
  - Performance: √çndices estrat√©gicos
  
  üë• Autores:
  - Leonel Gonz√°lez
  - [Nombre del compa√±ero]
  
  üéì Instituci√≥n:
  Universidad Tecnol√≥gica Nacional (UTN)
  Bases de Datos I - Trabajo Final Integrador
  Octubre 2025
  '''
}

// =========================================================================
// ENUM TYPES (Para documentaci√≥n de valores v√°lidos)
// =========================================================================
Enum estado_pedido {
  NUEVO [note: 'Pedido reci√©n creado, pendiente de procesamiento']
  FACTURADO [note: 'Pedido facturado, listo para env√≠o']
  ENVIADO [note: 'Pedido despachado y en tr√°nsito']
}

Enum empresa_envio {
  ANDREANI [note: 'Empresa de log√≠stica Andreani']
  OCA [note: 'Empresa de correo OCA']
  CORREO_ARG [note: 'Correo Argentino']
}

Enum tipo_envio {
  ESTANDAR [note: 'Env√≠o est√°ndar (3-7 d√≠as h√°biles)']
  EXPRES [note: 'Env√≠o express (24-48 horas)']
}

Enum estado_envio {
  EN_PREPARACION [note: 'Env√≠o en preparaci√≥n en dep√≥sito']
  EN_TRANSITO [note: 'Env√≠o despachado y en tr√°nsito']
  ENTREGADO [note: 'Env√≠o entregado al destinatario']
}